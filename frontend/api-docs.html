<!DOCTYPE html>
<html lang="en">
<head>
  <me        <h1 class="text-3xl font-bold text-gray-800 mb-2 flex items-center">
          <i class="fas fa-code mr-3 text-indigo-600"></i>
          API Documentation
          <span class="ml-3 text-sm bg-blue-100 text-blue-800 px-2 py-1 rounded-full">Vercel Hobby</span>
        </h1>
        <p class="text-gray-600">REST API for R2 File Manager - Optimized for Vercel Hobby Plan</p>arset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>API Documentation - R2 File Manager</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-core.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
  <style>
    :root {
      --primary-color: #4f46e5;
      --primary-hover: #4338ca;
    }
    .toast {
      animation: slide-in 0.3s ease-out, fade-out 0.5s ease-in forwards;
      animation-delay: 0s, 3.5s;
    }
    @keyframes slide-in {
      from { transform: translateY(100%); opacity: 0; }
      to { transform: translateY(0); opacity: 1; }
    }
    @keyframes fade-out {
      from { opacity: 1; }
      to { opacity: 0; }
    }
    .endpoint-card {
      transition: transform 0.2s ease-out, box-shadow 0.2s ease-out;
    }
    .endpoint-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
    }
    pre code {
      font-size: 0.875rem;
    }
  </style>
</head>
<body class="bg-gray-100 min-h-screen font-sans">
  
  <div id="toast-container" class="fixed bottom-5 right-5 z-50 flex flex-col gap-3"></div>

  <div class="container mx-auto px-4 py-6 max-w-6xl">
    <!-- Header -->
    <header class="mb-8 flex flex-col md:flex-row justify-between items-start md:items-center">
      <div>
        <h1 class="text-3xl font-bold text-gray-800 mb-2 flex items-center">
          <i class="fas fa-code mr-3 text-indigo-600"></i>
          API Documentation
        </h1>
        <p class="text-gray-600">REST API for Qiblat File Manager - External Application Integration</p>
      </div>
      <div class="flex items-center gap-3 mt-4 md:mt-0">
        <button id="generateApiKeyBtn" class="bg-indigo-600 text-white px-4 py-2 rounded-lg hover:bg-indigo-700 transition-colors text-sm font-semibold">
          <i class="fas fa-key mr-2"></i> Show API Key
        </button>
        <a href="/" class="bg-gray-500 text-white px-4 py-2 rounded-lg hover:bg-gray-600 transition-colors text-sm font-semibold">
          <i class="fas fa-arrow-left mr-2"></i> Back to Files
        </a>
      </div>
    </header>

    <!-- API Key Section -->
    <div id="apiKeySection" class="bg-white rounded-lg shadow-sm p-6 mb-8 hidden">
      <h2 class="text-xl font-bold text-gray-800 mb-4 flex items-center">
        <i class="fas fa-key mr-2 text-yellow-500"></i>
        API Authentication
      </h2>
      <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4 mb-4">
        <div class="flex items-start">
          <i class="fas fa-exclamation-triangle text-yellow-500 mt-1 mr-3"></i>
          <div>
            <h3 class="font-semibold text-yellow-800">Security Warning</h3>
            <p class="text-yellow-700 text-sm">Keep your API key secure. Do not share it or commit it to version control.</p>
          </div>
        </div>
      </div>
      <div class="space-y-4">
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2">Your API Key</label>
          <div class="flex items-center gap-2">
            <input type="password" id="apiKeyDisplay" readonly class="flex-1 px-3 py-2 border border-gray-300 rounded-lg bg-gray-50 font-mono text-sm">
            <button id="toggleApiKeyBtn" class="p-2 text-gray-500 hover:text-gray-700">
              <i class="fas fa-eye"></i>
            </button>
            <button id="copyApiKeyBtn" class="bg-green-500 text-white px-3 py-2 rounded-lg hover:bg-green-600 transition-colors text-sm">
              <i class="fas fa-copy mr-1"></i> Copy
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Base URL -->
    <div class="bg-white rounded-lg shadow-sm p-6 mb-8">
      <h2 class="text-xl font-bold text-gray-800 mb-4">Base URL</h2>
      <div class="bg-gray-50 rounded-lg p-4 font-mono text-sm">
        <span class="text-gray-600">Base URL:</span> <span class="text-indigo-600 font-semibold" id="baseUrl">http://localhost:3000/api</span>
        <button id="copyBaseUrlBtn" class="ml-2 text-gray-500 hover:text-gray-700">
          <i class="fas fa-copy"></i>
        </button>
      </div>
    </div>

    <!-- Authentication -->
    <div class="bg-white rounded-lg shadow-sm p-6 mb-8">
      <h2 class="text-xl font-bold text-gray-800 mb-4">Authentication</h2>
      <p class="text-gray-600 mb-4">All API endpoints require authentication using an API key. Include the API key in one of the following ways:</p>
      
      <div class="space-y-4">
        <div>
          <h3 class="font-semibold text-gray-700 mb-2">Option 1: X-API-Key Header</h3>
          <pre class="bg-gray-900 text-gray-100 p-4 rounded-lg overflow-x-auto"><code class="language-bash">curl -H "X-API-Key: your-api-key" \
     -X POST \
     http://localhost:3000/api/upload</code></pre>
        </div>
        
        <div>
          <h3 class="font-semibold text-gray-700 mb-2">Option 2: Authorization Bearer</h3>
          <pre class="bg-gray-900 text-gray-100 p-4 rounded-lg overflow-x-auto"><code class="language-bash">curl -H "Authorization: Bearer your-api-key" \
     -X POST \
     http://localhost:3000/api/upload</code></pre>
        </div>
      </div>
    </div>

    <!-- Endpoints -->
    <div class="space-y-6">
      <!-- Upload Single File -->
      <div class="endpoint-card bg-white rounded-lg shadow-sm p-6">
        <div class="flex items-center justify-between mb-4">
          <h3 class="text-xl font-bold text-gray-800 flex items-center">
            <span class="bg-green-100 text-green-700 px-2 py-1 rounded text-sm font-mono mr-3">POST</span>
            Upload Single File
          </h3>
          <span class="text-sm text-gray-500">/api/upload</span>
        </div>
        
        <p class="text-gray-600 mb-4">Upload a single file to R2 storage.</p>
        
        <div class="grid md:grid-cols-2 gap-6">
          <div>
            <h4 class="font-semibold text-gray-700 mb-2">Request</h4>
            <pre class="bg-gray-900 text-gray-100 p-4 rounded-lg overflow-x-auto text-sm"><code class="language-bash">curl -X POST \
  -H "X-API-Key: your-api-key" \
  -F "file=@/path/to/your/file.jpg" \
  http://localhost:3000/api/upload</code></pre>
          </div>
          
          <div>
            <h4 class="font-semibold text-gray-700 mb-2">Response</h4>
            <pre class="bg-gray-900 text-gray-100 p-4 rounded-lg overflow-x-auto text-sm"><code class="language-json">{
  "success": true,
  "message": "File uploaded successfully",
  "data": {
    "filename": "1640995200000-image.jpg",
    "originalName": "image.jpg",
    "key": "1640995200000-image.jpg",
    "size": 245760,
    "contentType": "image/jpeg",
    "publicUrl": "https://...",
    "downloadUrl": "/r2/download/...",
    "uploadedAt": "2023-12-31T12:00:00.000Z"
  }
}</code></pre>
          </div>
        </div>
      </div>

      <!-- Upload Multiple Files -->
      <div class="endpoint-card bg-white rounded-lg shadow-sm p-6">
        <div class="flex items-center justify-between mb-4">
          <h3 class="text-xl font-bold text-gray-800 flex items-center">
            <span class="bg-green-100 text-green-700 px-2 py-1 rounded text-sm font-mono mr-3">POST</span>
            Upload Multiple Files
          </h3>
          <span class="text-sm text-gray-500">/api/upload-multiple</span>
        </div>
        
        <p class="text-gray-600 mb-4">Upload multiple files (max 10) to R2 storage.</p>
        
        <div class="grid md:grid-cols-2 gap-6">
          <div>
            <h4 class="font-semibold text-gray-700 mb-2">Request</h4>
            <pre class="bg-gray-900 text-gray-100 p-4 rounded-lg overflow-x-auto text-sm"><code class="language-bash">curl -X POST \
  -H "X-API-Key: your-api-key" \
  -F "files=@/path/to/file1.jpg" \
  -F "files=@/path/to/file2.png" \
  http://localhost:3000/api/upload-multiple</code></pre>
          </div>
          
          <div>
            <h4 class="font-semibold text-gray-700 mb-2">Response</h4>
            <pre class="bg-gray-900 text-gray-100 p-4 rounded-lg overflow-x-auto text-sm"><code class="language-json">{
  "success": true,
  "message": "2 files uploaded successfully",
  "data": {
    "uploaded": [...],
    "errors": [],
    "summary": {
      "total": 2,
      "successful": 2,
      "failed": 0
    }
  }
}</code></pre>
          </div>
        </div>
      </div>

      <!-- List Files -->
      <div class="endpoint-card bg-white rounded-lg shadow-sm p-6">
        <div class="flex items-center justify-between mb-4">
          <h3 class="text-xl font-bold text-gray-800 flex items-center">
            <span class="bg-blue-100 text-blue-700 px-2 py-1 rounded text-sm font-mono mr-3">GET</span>
            List Files
          </h3>
          <span class="text-sm text-gray-500">/api/files</span>
        </div>
        
        <p class="text-gray-600 mb-4">Get a list of all uploaded files with pagination support.</p>
        
        <div class="grid md:grid-cols-2 gap-6">
          <div>
            <h4 class="font-semibold text-gray-700 mb-2">Request</h4>
            <pre class="bg-gray-900 text-gray-100 p-4 rounded-lg overflow-x-auto text-sm"><code class="language-bash">curl -H "X-API-Key: your-api-key" \
  "http://localhost:3000/api/files?limit=50&prefix=image"</code></pre>
            
            <h5 class="font-medium text-gray-600 mt-4 mb-2">Query Parameters</h5>
            <ul class="text-sm text-gray-600 space-y-1">
              <li><code class="bg-gray-100 px-1 rounded">limit</code> - Number of files to return (default: 100)</li>
              <li><code class="bg-gray-100 px-1 rounded">token</code> - Next page token for pagination</li>
              <li><code class="bg-gray-100 px-1 rounded">prefix</code> - Filter files by prefix</li>
            </ul>
          </div>
          
          <div>
            <h4 class="font-semibold text-gray-700 mb-2">Response</h4>
            <pre class="bg-gray-900 text-gray-100 p-4 rounded-lg overflow-x-auto text-sm"><code class="language-json">{
  "success": true,
  "data": {
    "files": [
      {
        "key": "1640995200000-image.jpg",
        "filename": "1640995200000-image.jpg",
        "size": 245760,
        "lastModified": "2023-12-31T12:00:00.000Z",
        "publicUrl": "https://...",
        "downloadUrl": "/r2/download/..."
      }
    ],
    "pagination": {
      "nextToken": null,
      "isTruncated": false,
      "count": 1
    }
  }
}</code></pre>
          </div>
        </div>
      </div>

      <!-- Delete File -->
      <div class="endpoint-card bg-white rounded-lg shadow-sm p-6">
        <div class="flex items-center justify-between mb-4">
          <h3 class="text-xl font-bold text-gray-800 flex items-center">
            <span class="bg-red-100 text-red-700 px-2 py-1 rounded text-sm font-mono mr-3">DELETE</span>
            Delete File
          </h3>
          <span class="text-sm text-gray-500">/api/files/:key</span>
        </div>
        
        <p class="text-gray-600 mb-4">Delete a file from R2 storage by its key.</p>
        
        <div class="grid md:grid-cols-2 gap-6">
          <div>
            <h4 class="font-semibold text-gray-700 mb-2">Request</h4>
            <pre class="bg-gray-900 text-gray-100 p-4 rounded-lg overflow-x-auto text-sm"><code class="language-bash">curl -X DELETE \
  -H "X-API-Key: your-api-key" \
  http://localhost:3000/api/files/1640995200000-image.jpg</code></pre>
          </div>
          
          <div>
            <h4 class="font-semibold text-gray-700 mb-2">Response</h4>
            <pre class="bg-gray-900 text-gray-100 p-4 rounded-lg overflow-x-auto text-sm"><code class="language-json">{
  "success": true,
  "message": "File deleted successfully",
  "data": {
    "key": "1640995200000-image.jpg"
  }
}</code></pre>
          </div>
        </div>
      </div>

      <!-- API Info -->
      <div class="endpoint-card bg-white rounded-lg shadow-sm p-6">
        <div class="flex items-center justify-between mb-4">
          <h3 class="text-xl font-bold text-gray-800 flex items-center">
            <span class="bg-purple-100 text-purple-700 px-2 py-1 rounded text-sm font-mono mr-3">GET</span>
            API Information
          </h3>
          <span class="text-sm text-gray-500">/api/info</span>
        </div>
        
        <p class="text-gray-600 mb-4">Get API information and available endpoints.</p>
        
        <div class="grid md:grid-cols-2 gap-6">
          <div>
            <h4 class="font-semibold text-gray-700 mb-2">Request</h4>
            <pre class="bg-gray-900 text-gray-100 p-4 rounded-lg overflow-x-auto text-sm"><code class="language-bash">curl -H "X-API-Key: your-api-key" \
  http://localhost:3000/api/info</code></pre>
          </div>
          
          <div>
            <h4 class="font-semibold text-gray-700 mb-2">Response</h4>
            <pre class="bg-gray-900 text-gray-100 p-4 rounded-lg overflow-x-auto text-sm"><code class="language-json">{
  "success": true,
  "data": {
    "name": "R2 File Manager API",
    "version": "1.0.0",
    "endpoints": {
      "POST /api/upload": "Upload a single file",
      "POST /api/upload-multiple": "Upload multiple files (max 10)",
      "GET /api/files": "List all files with pagination",
      "DELETE /api/files/:key": "Delete a file by key",
      "GET /api/info": "API information"
    },
    "authentication": "API Key required in X-API-Key header or Authorization: Bearer <key>",
    "maxFileSize": "50MB per file"
  }
}</code></pre>
          </div>
        </div>
      </div>
    </div>

    <!-- Error Responses -->
    <div class="bg-white rounded-lg shadow-sm p-6 mt-8">
      <h2 class="text-xl font-bold text-gray-800 mb-4">Error Responses</h2>
      <div class="space-y-4">
        <div>
          <h3 class="font-semibold text-gray-700 mb-2">401 Unauthorized</h3>
          <pre class="bg-gray-900 text-gray-100 p-4 rounded-lg overflow-x-auto text-sm"><code class="language-json">{
  "error": "API key required",
  "message": "Provide API key in X-API-Key header or Authorization: Bearer <key>"
}</code></pre>
        </div>
        
        <div>
          <h3 class="font-semibold text-gray-700 mb-2">400 Bad Request</h3>
          <pre class="bg-gray-900 text-gray-100 p-4 rounded-lg overflow-x-auto text-sm"><code class="language-json">{
  "error": "No file uploaded",
  "message": "Please provide a file in the \"file\" field"
}</code></pre>
        </div>
        
        <div>
          <h3 class="font-semibold text-gray-700 mb-2">500 Internal Server Error</h3>
          <pre class="bg-gray-900 text-gray-100 p-4 rounded-lg overflow-x-auto text-sm"><code class="language-json">{
  "success": false,
  "error": "Upload failed",
  "message": "Detailed error message"
}</code></pre>
        </div>
      </div>
    </div>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', function() {
      const generateApiKeyBtn = document.getElementById('generateApiKeyBtn');
      const apiKeySection = document.getElementById('apiKeySection');
      const apiKeyDisplay = document.getElementById('apiKeyDisplay');
      const toggleApiKeyBtn = document.getElementById('toggleApiKeyBtn');
      const copyApiKeyBtn = document.getElementById('copyApiKeyBtn');
      const copyBaseUrlBtn = document.getElementById('copyBaseUrlBtn');
      const baseUrl = document.getElementById('baseUrl');

      // Set base URL
      baseUrl.textContent = `${window.location.origin}/api`;

      // Generate/Show API Key
      generateApiKeyBtn.addEventListener('click', async function() {
        try {
          // Check if user is authenticated first
          const authResponse = await fetch('/auth/status', {
            credentials: 'include'
          });

          if (!authResponse.ok) {
            showToast('error', 'Please login first to view API key');
            return;
          }

          // For demo purposes, we'll fetch the API key from environment
          // In a real app, you might want to generate a unique key per user
          showToast('info', 'Loading API key...');
          
          // Simulate API key (in real app, this would be from backend)
          const demoApiKey = 'demo-api-key-change-this-in-production';
          apiKeyDisplay.value = demoApiKey;
          apiKeySection.classList.remove('hidden');
          generateApiKeyBtn.textContent = 'Hide API Key';
          generateApiKeyBtn.onclick = hideApiKey;
          
          showToast('success', 'API key loaded successfully');
        } catch (error) {
          showToast('error', 'Failed to load API key');
        }
      });

      function hideApiKey() {
        apiKeySection.classList.add('hidden');
        generateApiKeyBtn.textContent = 'Show API Key';
        generateApiKeyBtn.onclick = generateApiKeyBtn.onclick;
      }

      // Toggle API Key visibility
      toggleApiKeyBtn.addEventListener('click', function() {
        const type = apiKeyDisplay.getAttribute('type') === 'password' ? 'text' : 'password';
        apiKeyDisplay.setAttribute('type', type);
        
        const icon = this.querySelector('i');
        icon.classList.toggle('fa-eye');
        icon.classList.toggle('fa-eye-slash');
      });

      // Copy API Key
      copyApiKeyBtn.addEventListener('click', function() {
        navigator.clipboard.writeText(apiKeyDisplay.value).then(() => {
          showToast('success', 'API key copied to clipboard');
        }).catch(() => {
          showToast('error', 'Failed to copy API key');
        });
      });

      // Copy Base URL
      copyBaseUrlBtn.addEventListener('click', function() {
        navigator.clipboard.writeText(baseUrl.textContent).then(() => {
          showToast('success', 'Base URL copied to clipboard');
        }).catch(() => {
          showToast('error', 'Failed to copy base URL');
        });
      });

      // Toast notification system
      function showToast(type, message) {
        const toastContainer = document.getElementById('toast-container');
        const toast = document.createElement('div');
        
        const icons = { 
          success: 'fa-check-circle', 
          error: 'fa-exclamation-circle', 
          info: 'fa-info-circle' 
        };
        const colors = { 
          success: 'green', 
          error: 'red', 
          info: 'blue' 
        };
        
        toast.className = `toast shadow-lg rounded-lg p-4 flex items-center max-w-sm w-full bg-white border-l-4 border-${colors[type]}-500`;
        toast.innerHTML = `
          <i class="fas ${icons[type]} mr-3 text-${colors[type]}-500 text-xl"></i> 
          <span class="text-gray-700">${message}</span>
        `;
        
        toastContainer.appendChild(toast);
        setTimeout(() => toast.remove(), 4000);
      }
    });
  </script>
</body>
</html>
